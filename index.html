<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åºŸåœŸè¡ŒåŠ¨ - Pixel Extraction RPG</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts åƒç´ å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #171717;
            color: #e2e8f0;
        }
        .pixel-font { 
            font-family: 'VT323', monospace; 
            text-shadow: 0 0 2px rgba(0, 255, 0, 0.3);
        }
        .game-container { 
            font-family: 'VT323', monospace; 
            /* å¢å¤§åŸºç¡€å­—å· */
            font-size: 1.25rem; 
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .bg-noise { background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E"); }
        
        /* è€è™æœºåŠ¨ç”»æ•ˆæœ */
        @keyframes slotSpin {
            0% { transform: translateY(-100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .slot-item { animation: slotSpin 0.2s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- å›¾æ ‡ç»„ä»¶ (æ‰‹åŠ¨å®šä¹‰ SVG ä»¥æ›¿ä»£ lucide-react) ---
        const IconBase = ({ d, color, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`${color} ${className}`}>
                {d}
            </svg>
        );

        const Sword = (props) => <IconBase {...props} d={<path d="M14.5 17.5L3 6V3h3l11.5 11.5m-5-5l5 5m-5-5l5 5" />} />;
        const Shield = (props) => <IconBase {...props} d={<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />} />;
        const Heart = (props) => <IconBase {...props} d={<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />} />;
        const Zap = (props) => <IconBase {...props} d={<path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />} />;
        const Skull = (props) => <IconBase {...props} d={<><path d="M12 2c-4.42 0-8 3.58-8 8a8.01 8.01 0 0 0 2.5 5.8l1.5 2.2H16l1.5-2.2A8.01 8.01 0 0 0 20 10c0-4.42-3.58-8-8-8z"/><path d="M9 14h6"/><path d="M15 17h.01"/><path d="M9 17h.01" /></>} />;
        const ShoppingBag = (props) => <IconBase {...props} d={<><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0" /></>} />;
        const Briefcase = (props) => <IconBase {...props} d={<><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></>} />;
        const Footprints = (props) => <IconBase {...props} d={<><path d="M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 11 3.8 11 8c0 1.25-.76 2.5-2 3.5-1.24 1-2 2.25-2 3.5V17"/><path d="M14 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C8.63 6 7 7.8 7 12c0 1.25.76 2.5 2 3.5 1.24 1 2 2.25 2 3.5V21" /></>} />;
        const LogOut = (props) => <IconBase {...props} d={<><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12" /></>} />;
        const AlertTriangle = (props) => <IconBase {...props} d={<><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17" /></>} />;
        const Radio = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14" /></>} />;
        const Coins = (props) => <IconBase {...props} d={<><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="M17.121 17.121A3 3 0 1 0 21.364 21.364 3 3 0 1 0 17.121 17.121z" /></>} />;
        const Trash2 = (props) => <IconBase {...props} d={<><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17" /></>} />;
        const Utensils = (props) => <IconBase {...props} d={<><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" /></>} />;
        const Smile = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9" /></>} />;
        const Activity = (props) => <IconBase {...props} d={<polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />} />;
        const Hammer = (props) => <IconBase {...props} d={<><path d="M15 12l-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15L22 10.64"/><path d="M20.91 8.26L15.73 3.08a1 1 0 0 0-1.41 0l-1.42 1.42a1 1 0 0 0 0 1.41l5.66 5.66a1 1 0 0 0 1.41 0l1.42-1.42a1 1 0 0 0 0-1.41z" /></>} />;
        const HelpCircle = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17" /></>} />;
        const Gem = (props) => <IconBase {...props} d={<path d="M6 3h12l4 6-10 13L2 9z" />} />;
        const Dices = (props) => <IconBase {...props} d={<><rect width="12" height="12" x="2" y="10" rx="2" ry="2" /><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6" /><path d="M6 18h.01" /><path d="M10 14h.01" /><path d="M15 6h.01" /><path d="M18 9h.01" /></>} />;

        // --- æ¸¸æˆæ•°æ®é…ç½® ---
        const ITEMS = {
          medkit:   { id: 'medkit', name: 'æ€¥æ•‘åŒ…', type: 'consumable', cost: 60, effect: 'heal', value: 40, desc: 'æ¢å¤40ç”Ÿå‘½', rarity: 'white' },
          food:     { id: 'food', name: 'å‹ç¼©é¥¼å¹²', type: 'consumable', cost: 30, effect: 'satiety', value: 40, desc: 'æ¢å¤40é¥±é£Ÿ', rarity: 'white' },
          alcohol:  { id: 'alcohol', name: 'é™ˆå¹´å¨å£«å¿Œ', type: 'consumable', cost: 80, effect: 'mood', value: 50, desc: 'æ¢å¤50å¿ƒæƒ…,å‡å°‘10San', rarity: 'green' },
          pills:    { id: 'pills', name: 'é•‡é™å‰‚', type: 'consumable', cost: 120, effect: 'sanity', value: 40, desc: 'æ¢å¤40ç†æ™º(San)', rarity: 'blue' },
          ammo_box: { id: 'ammo_box', name: 'è‡ªåˆ¶å¼¹è¯ç®±', type: 'consumable', cost: 0, effect: 'buff_atk', value: 10, desc: 'ä¸‹ä¸€æ¬¡æˆ˜æ–—ä¼¤å®³+10 (å·¥ä½œå°åˆ¶é€ )', rarity: 'green' },
        };

        const GEAR = {
          knife:    { id: 'knife', name: 'ç”Ÿé”ˆåŒ•é¦–', type: 'weapon', cost: 0, atk: 2, desc: 'èŠèƒœäºæ— ' },
          pistol:   { id: 'pistol', name: 'æ—§æ‰‹æª', type: 'weapon', cost: 150, atk: 5, desc: 'å¯é çš„ä¼™ä¼´' },
          rifle:    { id: 'rifle', name: 'çªå‡»æ­¥æª', type: 'weapon', cost: 400, atk: 12, desc: 'ç«åŠ›å‹åˆ¶' },
          clothes:  { id: 'clothes', name: 'ä¾¿æœ', type: 'armor', cost: 0, def: 0, desc: 'ä¸é˜²å¼¹' },
          vest:     { id: 'vest', name: 'é˜²å¼¹èƒŒå¿ƒ', type: 'armor', cost: 200, def: 3, desc: 'å‡å°‘3ç‚¹ä¼¤å®³' },
          heavy:    { id: 'heavy', name: 'é‡å‹è£…ç”²', type: 'armor', cost: 500, def: 8, desc: 'ç§»åŠ¨å¦å…‹' },
        };

        const RELICS = {
          vampire:    { id: 'vampire', name: 'å¸è¡€é¬¼ä¹‹ç‰™', desc: 'å‡»æ€æ•Œäººå›å¤ 5 HP', rarity: 'purple', type: 'relic' },
          cat:        { id: 'cat', name: 'æ‹›è´¢çŒ«', desc: 'æ’¤ç¦»ç»“ç®—é‡‘å¸ +20%', rarity: 'purple', type: 'relic' },
          adrenaline: { id: 'adrenaline', name: 'è‚¾ä¸Šè…ºç´ ', desc: 'HP < 30% æ—¶æ”»å‡»åŠ›ç¿»å€', rarity: 'purple', type: 'relic' },
        };

        const FACILITIES = {
          medical:   { id: 'medical', name: 'æˆ˜åœ°åŒ»ç–—ç«™', cost: { 'èºä¸ç»„ä»¶': 10, 'åºŸæ—§é’¢æ': 5 }, desc: 'æ’¤ç¦»åè‡ªåŠ¨æ¢å¤ç¿»å€ (20->40)' },
          workbench: { id: 'workbench', name: 'ç²¾å¯†å·¥ä½œå°', cost: { 'çº¿æç»„ä»¶': 5, 'è“„ç”µæ± ': 1 }, desc: 'å…è®¸æ¶ˆè€—åºŸæ–™åˆ¶é€ å¼ºåŠ›å¼¹è¯' },
          kitchen:   { id: 'kitchen', name: 'é‡æˆ˜å¨æˆ¿', cost: { 'ç¥ç§˜è‚‰ç½å¤´': 3 }, desc: 'é¥±é£Ÿåº¦ä¸Šé™ +50' },
        };

        const STORY_EVENTS = [
          {
            id: 'injured_scavenger',
            text: 'ä½ å‘ç°ä¸€ä¸ªå—ä¼¤çš„æ‹¾è’è€…é åœ¨å¢™è¾¹ï¼Œè…¹éƒ¨çš„ä¼¤å£æ­£åœ¨æ¸—è¡€ã€‚',
            choices: [
              { id: 'help', text: 'æ•‘åŠ© (æ¶ˆè€—æ€¥æ•‘åŒ…)', req: { item: 'medkit' }, resultText: 'ä½ åŒ…æ‰äº†ä»–çš„ä¼¤å£ã€‚ä»–æ„Ÿæ¿€åœ°å¡ç»™ä½ ä¸€äº›ä¸œè¥¿ã€‚', mood: 20, sanity: 5, lootChance: 1.0 },
              { id: 'rob', text: 'æ‰“åŠ«', resultText: 'ä½ è¶ç«æ‰“åŠ«ã€‚ä»–è¯•å›¾åæŠ—...', combat: true, enemyId: 'weak_scavenger', mood: -10, sanity: -10 },
              { id: 'ignore', text: 'æ— è§†', resultText: 'ä½ ä»ä»–èº«è¾¹èµ°è¿‡ï¼Œå‡è£…æ²¡å¬è§ä»–çš„å‘»åŸã€‚', mood: -5, sanity: -2 }
            ]
          },
          {
            id: 'abandoned_shrine',
            text: 'åºŸå¢Ÿæ·±å¤„æœ‰ä¸€åº§å †æ»¡ç”µå­å…ƒä»¶çš„å¥‡æ€ªç¥­å›ï¼Œæ•£å‘ç€å¾®å…‰ã€‚',
            choices: [
              { id: 'pray', text: 'ç¥ˆç¥· (æ¶ˆè€—5é¥±é£Ÿ)', req: { stat: 'satiety', val: 5 }, resultText: 'ä½ æ„Ÿåˆ°ä¸€é˜µå¹³é™ï¼Œä½†ä¹Ÿæ›´åŠ é¥¥é¥¿ã€‚', mood: 10, sanity: 20 },
              { id: 'desecrate', text: 'æœåˆ®ç¥­å›', resultText: 'ä½ æ‹¿èµ°äº†ä¸Šé¢çš„é›¶ä»¶ï¼Œä½†æ„Ÿè§‰æœ‰ä»€ä¹ˆä¸œè¥¿è·Ÿä¸Šäº†ä½ ...', combat: true, enemyId: 'glitch', mood: 0, sanity: -15, lootChance: 1.0 },
              { id: 'leave', text: 'ç¦»å¼€', resultText: 'ä¸ä½œæ­»å°±ä¸ä¼šæ­»ã€‚', mood: 0, sanity: 0 }
            ]
          }
        ];

        const RARITY_CONFIG = {
          white:   { label: 'æ™®é€š', color: 'text-slate-400', border: 'border-slate-500', bg: 'bg-slate-800' },
          green:   { label: 'ä¼˜è‰¯', color: 'text-emerald-400', border: 'border-emerald-500', bg: 'bg-emerald-900/20' },
          blue:    { label: 'ç¨€æœ‰', color: 'text-cyan-400', border: 'border-cyan-500', bg: 'bg-cyan-900/20' },
          purple:  { label: 'å²è¯—', color: 'text-fuchsia-400', border: 'border-fuchsia-500', bg: 'bg-fuchsia-900/20' },
          gold:    { label: 'ä¼ è¯´', color: 'text-amber-400', border: 'border-amber-500', bg: 'bg-amber-900/20' },
          special: { label: 'ç‰¹æ®Š', color: 'text-red-500 animate-pulse', border: 'border-red-500', bg: 'bg-red-900/20' },
        };

        const LOOT_DB = [
          { name: 'èºä¸ç»„ä»¶', val: 15, rarity: 'white', type: 'loot' },
          { name: 'åºŸæ—§é’¢æ', val: 25, rarity: 'white', type: 'loot' },
          { name: 'ç¥ç§˜è‚‰ç½å¤´', val: 30, rarity: 'white', type: 'loot' },
          { name: 'ç²—ç³™å¸ƒæ–™', val: 50, rarity: 'green', type: 'loot' },
          { name: 'çº¿æç»„ä»¶', val: 65, rarity: 'green', type: 'loot' },
          { name: 'æœªçŸ¥é…±æ–™', val: 80, rarity: 'green', type: 'loot' },
          { name: 'å¥½ç”¨çš„é’³å­', val: 150, rarity: 'blue', type: 'loot' },
          { name: 'æ¶¦æ»‘æ²¹', val: 180, rarity: 'blue', type: 'loot' },
          { name: 'ç‡ƒæ°”ç“¶', val: 220, rarity: 'blue', type: 'loot' },
          { name: 'ä¼˜è´¨é’¢æ', val: 400, rarity: 'purple', type: 'loot' },
          { name: 'è“„ç”µæ± ', val: 550, rarity: 'purple', type: 'loot' },
          { name: 'ç«è¯', val: 600, rarity: 'purple', type: 'loot' },
          { name: 'æ±‚ç”Ÿæ€¥æ•‘åŒ…', val: 1000, rarity: 'gold', type: 'loot' },
          { name: 'å®Œæ•´æŠ—ç”Ÿç´ ', val: 1200, rarity: 'gold', type: 'loot' },
          { name: 'æ±‚ç”Ÿæ— çº¿ç”µå‘å°„å™¨', val: 5000, rarity: 'special', type: 'loot' },
          { ...RELICS.vampire, val: 800 },
          { ...RELICS.cat, val: 800 },
          { ...RELICS.adrenaline, val: 800 },
        ];

        const ENEMIES = [
          { id: 'rat', name: 'å˜å¼‚è€é¼ ', hp: 10, atk: 3, exp: 10 },
          { id: 'scavenger', name: 'æµæµªæ‹¾è’è€…', hp: 25, atk: 6, exp: 30 },
          { id: 'thug', name: 'æ­¦è£…æš´å¾’', hp: 45, atk: 10, exp: 60 },
          { id: 'merc', name: 'ç²¾è‹±ä½£å…µ', hp: 80, atk: 15, exp: 150 },
        ];

        // --- æ ·å¼ç»„ä»¶ ---
        const PixelCard = ({ children, className = "", onClick, disabled }) => (
          <div 
            onClick={!disabled ? onClick : undefined}
            className={`
              relative border-2 border-slate-600 bg-slate-800 p-3 
              shadow-[2px_2px_0px_0px_rgba(0,0,0,0.8)] 
              active:shadow-none active:translate-y-[2px] active:translate-x-[2px]
              transition-all cursor-pointer select-none text-slate-200
              ${disabled ? 'opacity-50 cursor-not-allowed grayscale' : 'hover:bg-slate-700 hover:border-slate-400'}
              ${className}
            `}
          >
            {children}
          </div>
        );

        const ProgressBar = ({ current, max, color = "bg-green-600", label, icon }) => (
          <div className="flex items-center gap-1 text-sm leading-none mb-1 pixel-font w-full">
            {icon && <span className="w-4 text-slate-400">{icon}</span>}
            <div className="flex-1 h-2 bg-slate-900 border border-slate-600 relative">
              <div 
                className={`h-full ${color} transition-all duration-300`} 
                style={{ width: `${Math.max(0, Math.min(100, (current / max) * 100))}%` }}
              />
            </div>
          </div>
        );

        // è€è™æœºç»„ä»¶
        const SlotMachine = ({ bet, onSpin, result, isSpinning }) => {
            const symbols = ['ğŸ’€', 'ğŸ”§', 'ğŸ—', 'â˜¢ï¸', 'ğŸ’', '7ï¸âƒ£'];
            const [displaySlots, setDisplaySlots] = useState(['â“', 'â“', 'â“']);

            useEffect(() => {
                if (isSpinning) {
                    const interval = setInterval(() => {
                        setDisplaySlots([
                            symbols[Math.floor(Math.random() * symbols.length)],
                            symbols[Math.floor(Math.random() * symbols.length)],
                            symbols[Math.floor(Math.random() * symbols.length)]
                        ]);
                    }, 100);
                    return () => clearInterval(interval);
                } else if (result) {
                    setDisplaySlots(result);
                }
            }, [isSpinning, result]);

            return (
                <div className="bg-slate-900 p-4 border-4 border-yellow-600 rounded-lg text-center mb-4 relative overflow-hidden">
                    <div className="absolute inset-0 bg-yellow-900/10 pointer-events-none"></div>
                    <div className="flex justify-center gap-2 mb-4 bg-black/50 p-2 rounded">
                        {displaySlots.map((s, i) => (
                            <div key={i} className="w-16 h-16 bg-slate-200 border-4 border-slate-600 flex items-center justify-center text-4xl shadow-inner slot-item text-black">
                                {s}
                            </div>
                        ))}
                    </div>
                    <button 
                        onClick={onSpin} 
                        disabled={isSpinning}
                        className={`w-full py-3 text-xl font-bold rounded border-b-4 active:border-b-0 active:translate-y-1 transition-all ${
                            isSpinning ? 'bg-slate-600 border-slate-800 text-slate-400' : 'bg-red-600 border-red-800 hover:bg-red-500 text-white'
                        }`}
                    >
                        {isSpinning ? 'SPINNING...' : `PULL LEVER ($${bet})`}
                    </button>
                    <div className="mt-2 text-xs text-yellow-500/80 uppercase tracking-widest">
                        Match 2: x2 â€¢ Match 3: x10 â€¢ 777: x50
                    </div>
                </div>
            );
        };

        // --- ä¸»ç»„ä»¶ ---
        function ExtractionGame() {
          const [scene, setScene] = useState('home');
          const [logs, setLogs] = useState(["æ¬¢è¿æ¥åˆ° 0 å·ç¦åŒºã€‚å­˜æ´»ï¼Œæœåˆ®ï¼Œæš´å¯Œã€‚"]);
          const [confirmId, setConfirmId] = useState(null); // è´­ä¹°ç¡®è®¤çŠ¶æ€
          
          // å•†åº—çŠ¶æ€
          const [shopTab, setShopTab] = useState('buy'); // 'buy' | 'gamble'
          const [betAmount, setBetAmount] = useState(50);
          const [isSpinning, setIsSpinning] = useState(false);
          const [slotResult, setSlotResult] = useState(null);

          const [player, setPlayer] = useState({
            hp: 100, maxHp: 100,
            satiety: 100, maxSatiety: 100,
            mood: 100, maxMood: 100,
            sanity: 100, maxSanity: 100,
            money: 500, // ç¨å¾®å¢åŠ åˆå§‹èµ„é‡‘æ–¹ä¾¿æµ‹è¯•èµŒåš
            weapon: GEAR.knife,
            armor: GEAR.clothes,
            relics: [],
            facilities: {},
            inventory: [],
            storage: [],
          });

          const [raidState, setRaidState] = useState({
            distance: 0,
            dangerLevel: 1,
            currentEnemy: null,
            isGlitchEnemy: false,
            tempLoot: [],     
            currentLootItem: null,
            currentInteractiveEvent: null,
          });

          const addLog = (msg, type = 'neutral') => {
            const time = new Date().toLocaleTimeString('zh-CN', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            setLogs(prev => [`[${time}] ${msg}`, ...prev].slice(0, 8));
          };

          const countItemInStorage = (itemName) => {
            return player.storage.filter(i => i.name === itemName).length;
          };

          const removeItemsFromStorage = (itemName, count) => {
            let removed = 0;
            const newStorage = player.storage.filter(item => {
              if (item.name === itemName && removed < count) {
                removed++;
                return false;
              }
              return true;
            });
            return newStorage;
          };

          // ... (è®¾æ–½ã€å¼¹è¯ã€äº‹ä»¶é€»è¾‘ä¿æŒä¸å˜)
          const upgradeFacility = (facId) => {
            const facility = FACILITIES[facId];
            if (player.facilities[facId]) return;

            let canBuild = true;
            for (const [name, count] of Object.entries(facility.cost)) {
              if (countItemInStorage(name) < count) canBuild = false;
            }

            if (canBuild) {
              let newStorage = [...player.storage];
              for (const [name, count] of Object.entries(facility.cost)) {
                let removed = 0;
                newStorage = newStorage.filter(item => {
                  if (item.name === name && removed < count) {
                    removed++;
                    return false;
                  }
                  return true;
                });
              }

              const newFacilities = { ...player.facilities, [facId]: true };
              let updates = { storage: newStorage, facilities: newFacilities };

              if (facId === 'kitchen') {
                updates.maxSatiety = 150;
                updates.satiety = 150;
              }

              setPlayer(prev => ({ ...prev, ...updates }));
              addLog(`è®¾æ–½å»ºé€ æˆåŠŸï¼š${facility.name}`, 'success');
            } else {
              addLog('ææ–™ä¸è¶³ï¼Œæ— æ³•å»ºé€ ï¼', 'error');
            }
          };

          const craftAmmo = () => {
            const costMoney = 50;
            const material = 'åºŸæ—§é’¢æ';
            if (player.money >= costMoney && countItemInStorage(material) >= 1) {
              const newStorage = removeItemsFromStorage(material, 1);
              setPlayer(prev => ({
                ...prev,
                money: prev.money - costMoney,
                storage: [...newStorage, { ...ITEMS.ammo_box, type: 'consumable' }]
              }));
              addLog('åˆ¶é€ äº† è‡ªåˆ¶å¼¹è¯ç®±', 'success');
            } else {
              addLog('åˆ¶é€ ææ–™æˆ–èµ„é‡‘ä¸è¶³ ($50 + åºŸæ—§é’¢æ)', 'error');
            }
          };

          const handleEventChoice = (choice) => {
            if (choice.req) {
              if (choice.req.item) {
                const hasItem = player.storage.some(i => i.id === choice.req.item);
                if (!hasItem) {
                  addLog('ç¼ºå°‘æ‰€éœ€ç‰©å“ï¼', 'error');
                  return;
                }
                const idx = player.storage.findIndex(i => i.id === choice.req.item);
                const newStorage = player.storage.filter((_, i) => i !== idx);
                setPlayer(prev => ({ ...prev, storage: newStorage }));
              }
              if (choice.req.stat) {
                if (player[choice.req.stat] < choice.req.val) {
                  addLog('çŠ¶æ€ä¸è¶³ï¼', 'error');
                  return;
                }
                setPlayer(prev => ({ ...prev, [choice.req.stat]: prev[choice.req.stat] - choice.req.val }));
              }
            }
            addLog(choice.resultText);
            if (choice.mood) setPlayer(prev => ({ ...prev, mood: Math.min(prev.maxMood, prev.mood + choice.mood) }));
            if (choice.sanity) setPlayer(prev => ({ ...prev, sanity: Math.min(prev.maxSanity, prev.sanity + choice.sanity) }));
            if (choice.combat) {
              let enemyTemplate = ENEMIES[0];
              if (choice.enemyId === 'weak_scavenger') enemyTemplate = { name: 'å—ä¼¤çš„æ‹¾è’è€…', hp: 15, atk: 4, exp: 20 };
              if (choice.enemyId === 'glitch') enemyTemplate = { name: '?%#ERROR', hp: 60, atk: 12, exp: 0 };
              setRaidState(prev => ({ ...prev, currentEnemy: { ...enemyTemplate, maxHp: enemyTemplate.hp }, isGlitchEnemy: choice.enemyId === 'glitch' }));
              setScene('combat');
              return;
            }
            if (choice.lootChance) {
              if (Math.random() < choice.lootChance) {
                const loot = generateLootItem(raidState.distance + 500);
                setRaidState(prev => ({ ...prev, tempLoot: [...prev.tempLoot, loot], currentLootItem: loot }));
                setScene('event');
                return;
              }
            }
            setScene('raid');
          };

          // --- å•†åº—ä¸èµŒåšé€»è¾‘ ---
          const handleShopClick = (item, type) => {
            if (confirmId === item.id) {
                if (type === 'gear') buyGear(item);
                else buyItem(item);
                setConfirmId(null);
            } else {
                setConfirmId(item.id);
                setTimeout(() => { setConfirmId(prev => prev === item.id ? null : prev); }, 3000);
            }
          };

          const handleSpin = () => {
              if (player.money < betAmount) {
                  addLog("èµ„é‡‘ä¸è¶³ï¼", "error");
                  return;
              }
              setPlayer(p => ({ ...p, money: p.money - betAmount }));
              setIsSpinning(true);
              setSlotResult(null);

              setTimeout(() => {
                  const symbols = ['ğŸ’€', 'ğŸ”§', 'ğŸ”§', 'ğŸ—', 'ğŸ—', 'â˜¢ï¸', 'ğŸ’', '7ï¸âƒ£']; // è°ƒæ•´æƒé‡
                  const s1 = symbols[Math.floor(Math.random() * symbols.length)];
                  const s2 = symbols[Math.floor(Math.random() * symbols.length)];
                  const s3 = symbols[Math.floor(Math.random() * symbols.length)];
                  const result = [s1, s2, s3];
                  
                  setIsSpinning(false);
                  setSlotResult(result);

                  // ç»“ç®—
                  let winMult = 0;
                  if (s1 === s2 && s2 === s3) {
                      if (s1 === '7ï¸âƒ£') winMult = 50;
                      else if (s1 === 'ğŸ’') winMult = 20;
                      else if (s1 === 'ğŸ’€') winMult = 0; // 3ä¸ªéª·é«…å€’å¤§éœ‰
                      else winMult = 10;
                  } else if (s1 === s2 || s2 === s3 || s1 === s3) {
                      winMult = 2;
                  }

                  if (winMult > 0) {
                      const winAmount = betAmount * winMult;
                      setPlayer(p => ({ ...p, money: p.money + winAmount, mood: Math.min(p.maxMood, p.mood + 10) }));
                      addLog(`ğŸ° ä¸­å¥–ï¼è·å¾— $${winAmount} (å¿ƒæƒ…+10)`, "success");
                  } else {
                      setPlayer(p => ({ ...p, mood: Math.max(0, p.mood - 5) }));
                      addLog(`ğŸ° å¾ˆé—æ†¾ï¼Œæœªä¸­å¥– (å¿ƒæƒ…-5)`, "error");
                  }

              }, 1500);
          };

          // ... (ä¹°å–ä½¿ç”¨é€»è¾‘ä¿æŒä¸å˜)
          const buyItem = (item) => {
            if (player.money >= item.cost) {
              setPlayer(prev => ({ ...prev, money: prev.money - item.cost, storage: [...prev.storage, { ...item, type: 'consumable' }] }));
              addLog(`è´­ä¹°äº† ${item.name}`, 'success');
            } else { addLog('èµ„é‡‘ä¸è¶³ï¼', 'error'); }
          };
          const buyGear = (gear) => {
            if (player.money >= gear.cost) {
              setPlayer(prev => ({ ...prev, money: prev.money - gear.cost, [gear.type]: gear }));
              addLog(`è£…å¤‡äº† ${gear.name}`, 'success');
            } else { addLog('èµ„é‡‘ä¸è¶³ï¼', 'error'); }
          };
          const sellItem = (index) => {
            const item = player.storage[index];
            if (!item) return;
            const sellPrice = item.val || Math.floor(item.cost / 2) || 1;
            const catRelic = player.relics.find(r => r.id === 'cat');
            const finalPrice = catRelic ? Math.floor(sellPrice * 1.2) : sellPrice;
            setPlayer(prev => ({ ...prev, money: prev.money + finalPrice, storage: prev.storage.filter((_, i) => i !== index) }));
            addLog(`å‡ºå”® ${item.name}ï¼Œè·å¾— $${finalPrice}`, 'success');
          };
          const sellAllLoot = () => {
            const lootItems = player.storage.filter(i => i.type === 'loot');
            if (lootItems.length === 0) { addLog('æ²¡æœ‰å¯å‡ºå”®çš„æˆ˜åˆ©å“ã€‚'); return; }
            const catRelic = player.relics.find(r => r.id === 'cat');
            let totalVal = lootItems.reduce((acc, i) => acc + (i.val || 0), 0);
            if (catRelic) totalVal = Math.floor(totalVal * 1.2);
            setPlayer(prev => ({ ...prev, money: prev.money + totalVal, storage: prev.storage.filter(i => i.type !== 'loot') }));
            addLog(`ä¸€é”®å‡ºå”®æ‚ç‰©ï¼Œè·å¾— $${totalVal}`, 'success');
          };
          const useItem = (index) => {
            const item = player.storage[index];
            if (!item) return;
            if (item.type === 'relic') {
               if (player.relics.some(r => r.id === item.id)) { addLog('å·²è£…å¤‡è¯¥é—ç‰©ã€‚'); return; }
               setPlayer(prev => ({ ...prev, relics: [...prev.relics, item], storage: prev.storage.filter((_, i) => i !== index) }));
               addLog(`è£…å¤‡é—ç‰©ï¼š${item.name}`, 'success');
               return;
            }
            if (item.type !== 'consumable') return;
            let used = false;
            let newPlayer = { ...player };
            if (item.effect === 'heal' && player.hp < player.maxHp) { newPlayer.hp = Math.min(player.maxHp, player.hp + item.value); used = true; }
            else if (item.effect === 'satiety' && player.satiety < player.maxSatiety) { newPlayer.satiety = Math.min(player.maxSatiety, player.satiety + item.value); used = true; }
            else if (item.effect === 'mood' && player.mood < player.maxMood) { newPlayer.mood = Math.min(player.maxMood, player.mood + item.value); newPlayer.sanity = Math.max(0, player.sanity - 10); used = true; }
            else if (item.effect === 'sanity' && player.sanity < player.maxSanity) { newPlayer.sanity = Math.min(player.maxSanity, player.sanity + item.value); used = true; }
            else if (item.effect === 'buff_atk') { addLog('Buffæ•ˆæœæš‚æœªå®è£…', 'error'); used = false; }
            if (used) {
               newPlayer.storage = player.storage.filter((_, i) => i !== index);
               setPlayer(newPlayer);
               addLog(`ä½¿ç”¨äº† ${item.name}ã€‚`, 'success');
            }
          };

          const startRaid = () => {
            setRaidState({ distance: 0, dangerLevel: 1, currentEnemy: null, isGlitchEnemy: false, tempLoot: [], currentLootItem: null, currentInteractiveEvent: null });
            setPlayer(p => ({ ...p, sanity: Math.max(0, p.sanity - 5) }));
            setScene('raid');
            addLog('è¿›å…¥åºŸå¢Ÿ... æ„Ÿè§‰åˆ°è¿™é‡Œå……æ»¡äº†æ¶æ„ã€‚');
          };

          const generateLootItem = (dist) => {
            const rand = Math.random() * 100;
            const luckBonus = Math.floor(dist / 100); 
            const moodBonus = player.mood > 80 ? 5 : 0;
            let targetRarity = 'white';
            if (dist > 3000 && Math.random() > 0.98) targetRarity = 'special';
            else {
                const score = rand + luckBonus + moodBonus;
                if (score > 140) targetRarity = 'gold';       
                else if (score > 115) targetRarity = 'purple';
                else if (score > 90) targetRarity = 'blue';
                else if (score > 60) targetRarity = 'green';
                else targetRarity = 'white';
            }
            let pool = LOOT_DB.filter(i => i.rarity === targetRarity);
            if (pool.length === 0) pool = LOOT_DB.filter(i => i.rarity === 'white');
            return pool[Math.floor(Math.random() * pool.length)];
          };

          const explore = () => {
            if (player.satiety <= 0) {
                addLog('ä½ é¥¿å¾—èµ°ä¸åŠ¨äº†... ç”Ÿå‘½å€¼æ­£åœ¨æµå¤±ï¼', 'danger');
                setPlayer(p => ({ ...p, hp: Math.max(0, p.hp - 10) }));
                if (player.hp <= 10) setScene('gameover');
                return;
            }
            const newDist = raidState.distance + 100;
            const rng = Math.random();
            const currentDanger = 1 + Math.floor(newDist / 500);
            setPlayer(prev => ({ ...prev, satiety: Math.max(0, prev.satiety - 5), sanity: Math.max(0, prev.sanity - 2) }));
            setRaidState(prev => ({ ...prev, distance: newDist, dangerLevel: currentDanger }));
            addLog(`æ·±å…¥åºŸå¢Ÿ ${newDist}m... (é¥±é£Ÿ-5, San-2)`);
            if (player.sanity < 50 && Math.random() > 0.7) addLog('ä½ å¬åˆ°è€³è¾¹æœ‰å¥‡æ€ªçš„ä½è¯­...', 'danger');
            if (rng < 0.2) {
              const event = STORY_EVENTS[Math.floor(Math.random() * STORY_EVENTS.length)];
              setRaidState(prev => ({ ...prev, currentInteractiveEvent: event }));
              setScene('interactive_event');
              addLog('å‰æ–¹å‡ºç°å¼‚å¸¸æƒ…å†µ...', 'blue');
              return;
            }
            if (rng < 0.45) { 
              let enemy = null; let isGlitch = false;
              if (player.sanity < 30 && Math.random() < 0.6) {
                  isGlitch = true;
                  const madnessScale = (50 - player.sanity) / 10;
                  enemy = { name: '?&%#@!', hp: 50 + (madnessScale * 20), maxHp: 50 + (madnessScale * 20), atk: 8 + (madnessScale * 3), exp: 0 };
              } else {
                  const enemyPool = ENEMIES.filter((_, idx) => idx < currentDanger);
                  const enemyTemplate = enemyPool[Math.floor(Math.random() * enemyPool.length)] || ENEMIES[ENEMIES.length-1];
                  enemy = { ...enemyTemplate, maxHp: enemyTemplate.hp };
              }
              setRaidState(prev => ({ ...prev, currentEnemy: enemy, isGlitchEnemy: isGlitch }));
              setPlayer(p => ({ ...p, sanity: Math.max(0, p.sanity - 5), mood: Math.max(0, p.mood - 2) }));
              setScene('combat');
              if (isGlitch) addLog('è­¦å‘Šï¼šé­é‡ä¸å¯åçŠ¶çš„å®ä½“ï¼', 'danger'); else addLog(`é­é‡æ•Œå¯¹ç›®æ ‡ï¼š${enemy.name}ï¼`, 'danger');
            } else if (rng < 0.8) {
              const lootItem = generateLootItem(newDist);
              setRaidState(prev => ({ ...prev, tempLoot: [...prev.tempLoot, lootItem], currentLootItem: lootItem }));
              setPlayer(p => ({ ...p, mood: Math.min(p.maxMood, p.mood + 5) }));
              addLog(`å‘ç°ç‰©èµ„ï¼š${lootItem.name}`, 'success');
              setScene('event');
            } else {
              setPlayer(p => ({ ...p, mood: Math.max(0, p.mood - 1) }));
              addLog('å‘¨å›´å¾ˆå®‰é™ï¼Œä¹Ÿè®¸å¤ªå®‰é™äº†ã€‚');
            }
          };

          const handleCombat = (action) => {
            if (!raidState.currentEnemy) return;
            if (action === 'attack') {
              let hitChance = 0.9; let critChance = 0.1; let finalAtk = player.weapon.atk;
              const adrenalineRelic = player.relics.find(r => r.id === 'adrenaline');
              if (adrenalineRelic && player.hp < player.maxHp * 0.3) { finalAtk *= 2; addLog('è‚¾ä¸Šè…ºç´ æ¿€æ´»ï¼ä¼¤å®³ç¿»å€ï¼', 'blue'); }
              if (player.mood > 80) { critChance = 0.3; }
              if (player.mood < 30) { hitChance = 0.6; critChance = 0; }
              if (raidState.isGlitchEnemy) { setPlayer(p => ({ ...p, satiety: Math.max(0, p.satiety - 2) })); addLog('æ”»å‡»è¿™ä¸ªæ€ªç‰©è®©ä½ æ„Ÿåˆ°å¼‚å¸¸ç–²æƒ«...(é¥±é£Ÿ-2)', 'danger'); }
              if (Math.random() > hitChance) {
                  addLog('ä½ çš„æ”»å‡»è½ç©ºäº†ï¼(å¿ƒæƒ…ä½è½)', 'error');
              } else {
                  let dmg = Math.max(1, finalAtk + Math.floor(Math.random() * 3));
                  if (Math.random() < critChance) { dmg = Math.floor(dmg * 1.5); addLog('æš´å‡»ï¼', 'success'); }
                  const remainingEnemyHp = raidState.currentEnemy.hp - dmg;
                  addLog(`ä½ é€ æˆäº† ${dmg} ç‚¹ä¼¤å®³ã€‚`);
                  if (remainingEnemyHp <= 0) {
                    addLog(`å‡»è´¥äº†æ•Œäººï¼`, 'success');
                    const vampireRelic = player.relics.find(r => r.id === 'vampire');
                    if (vampireRelic) { setPlayer(p => ({ ...p, hp: Math.min(p.maxHp, p.hp + 5) })); addLog('å¸è¡€é¬¼ä¹‹ç‰™ï¼šæ±²å–äº† 5 ç‚¹ç”Ÿå‘½ã€‚', 'blue'); }
                    setRaidState(prev => ({ ...prev, currentEnemy: null }));
                    setScene('raid');
                    return;
                  }
                  setRaidState(prev => ({ ...prev, currentEnemy: { ...prev.currentEnemy, hp: remainingEnemyHp } }));
              }
              const enemyDmg = Math.max(0, raidState.currentEnemy.atk - player.armor.def);
              setPlayer(prev => ({ ...prev, hp: prev.hp - enemyDmg, mood: Math.max(0, prev.mood - 2) }));
              addLog(`æ•Œäººåå‡»ï¼å—åˆ° ${enemyDmg} ç‚¹ä¼¤å®³ã€‚`, 'danger');
              if (player.hp - enemyDmg <= 0) setScene('gameover');
            } else if (action === 'flee') {
               let fleeChance = 0.5;
               if (player.mood > 80) fleeChance = 0.7;
               if (player.mood < 30) fleeChance = 0.3;
               if (Math.random() < fleeChance) { addLog('é€ƒè·‘æˆåŠŸï¼'); setRaidState(prev => ({ ...prev, currentEnemy: null })); setScene('raid'); }
               else { addLog('é€ƒè·‘å¤±è´¥ï¼è¢«æ•Œäººè¿½ä¸Šäº†ã€‚', 'danger'); const enemyDmg = Math.max(0, raidState.currentEnemy.atk - player.armor.def); setPlayer(prev => ({ ...prev, hp: prev.hp - enemyDmg })); if (player.hp - enemyDmg <= 0) setScene('gameover'); }
            }
          };

          const evac = () => {
            const hasSpecial = raidState.tempLoot.some(i => i.rarity === 'special');
            const healAmount = player.facilities.medical ? 40 : 20;
            setPlayer(prev => ({ ...prev, hp: Math.min(prev.maxHp, prev.hp + healAmount), sanity: Math.min(prev.maxSanity, prev.sanity + 20), mood: Math.min(prev.maxMood, prev.mood + 20), storage: [...prev.storage, ...raidState.tempLoot] }));
            if (player.facilities.medical) addLog('åŒ»ç–—ç«™ä¸ºæ‚¨æä¾›äº†æ·±åº¦æ²»ç–—ã€‚', 'blue');
            if (hasSpecial) addLog(`ä¿¡å·å‘å°„å™¨å·²å›æ”¶ï¼`, 'success');
            addLog(`æ’¤ç¦»æˆåŠŸï¼ç‰©èµ„å·²è½¬è¿è‡³ä»“åº“ã€‚`, 'success');
            setScene('result');
          };

          const resetGame = () => {
            setPlayer({ hp: 100, maxHp: 100, satiety: 100, maxSatiety: 100, mood: 100, maxMood: 100, sanity: 100, maxSanity: 100, money: 200, weapon: GEAR.knife, armor: GEAR.clothes, relics: [], facilities: {}, inventory: [], storage: [], });
            setScene('home'); setLogs(['é‡æ–°å¼€å§‹ã€‚ç¥ä½ å¥½è¿ï¼Œè¡Œè€…ã€‚']);
          }

          const CRTOverlay = () => {
              const glitchIntensity = player.sanity < 30 ? 'opacity-30' : 'opacity-0';
              return (
                <div className="pointer-events-none absolute inset-0 z-50 overflow-hidden rounded-lg">
                    <div className="absolute inset-0 bg-[linear-gradient(rgba(0,0,0,0)_50%,rgba(0,0,0,0.2)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,3px_100%] pointer-events-none" />
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_50%,rgba(0,0,0,0.4)_100%)] pointer-events-none" />
                    <div className={`absolute inset-0 bg-noise mix-blend-overlay ${glitchIntensity} pointer-events-none transition-opacity duration-1000`}></div>
                    {player.sanity < 50 && ( <div className="absolute top-2 left-2 text-[10px] text-red-500 animate-pulse font-bold tracking-widest">âš  MENTAL CRITICAL</div> )}
                </div>
              );
          };

          return (
            <div className="min-h-screen bg-neutral-900 flex items-center justify-center p-4 font-mono text-slate-200 select-none">
              <div className="game-container relative w-full max-w-md bg-slate-800 rounded-2xl p-6 border-b-8 border-r-8 border-slate-950 shadow-2xl">
                
                <div className="mb-4 flex justify-between items-end border-b-4 border-slate-600 pb-2">
                   <div>
                     <h1 className="text-3xl text-yellow-500 leading-none mb-1 tracking-wider">åºŸåœŸè¡ŒåŠ¨</h1>
                     <span className="text-lg text-slate-400">EXTRACTION RPG</span>
                   </div>
                   <div className="text-right">
                     <div className="text-green-400 text-2xl flex items-center gap-1 justify-end">
                        <span className="text-sm">$</span> {player.money}
                     </div>
                     <div className="text-xl text-slate-500">DAY {Math.floor(raidState.distance / 1000) + 1}</div>
                   </div>
                </div>

                <div className="relative bg-[#1a1c21] border-4 border-slate-700 rounded-lg min-h-[500px] flex flex-col justify-between overflow-hidden shadow-[inset_0_0_20px_rgba(0,0,0,0.8)]">
                    <CRTOverlay />
                    
                    <div className="relative z-10 p-5 flex-1 flex flex-col h-full overflow-hidden">
                        
                        {/* çŠ¶æ€æ ï¼šæˆ˜æ–—å¤–æ˜¾ç¤ºï¼Œæˆ˜æ–—æ—¶éšè—ä»¥è…¾å‡ºç©ºé—´ */}
                        {scene !== 'combat' && (
                            <div className="bg-slate-800/80 p-3 rounded mb-4 border border-slate-600 backdrop-blur-sm grid grid-cols-2 gap-x-4 gap-y-2 flex-none">
                                <div className="col-span-2">
                                     <div className="flex justify-between text-sm text-slate-400 mb-1">
                                        <span>HP {player.hp}/{player.maxHp}</span>
                                        <span className="flex gap-1">{player.relics.map((r,i) => <Gem key={i} size={12} className="text-purple-400"/>)}</span>
                                     </div>
                                     <ProgressBar current={player.hp} max={player.maxHp} color="bg-red-600" icon={<Heart size={14} className="text-red-500"/>} />
                                </div>
                                
                                <div>
                                     <ProgressBar current={player.satiety} max={player.maxSatiety} color="bg-yellow-600" icon={<Utensils size={14} className="text-yellow-500"/>} />
                                     <div className="flex justify-between text-xs text-slate-500 mt-0.5">
                                        <span>é¥±é£Ÿ</span><span>{player.satiety}/{player.maxSatiety}</span>
                                     </div>
                                </div>
                                <div>
                                     <ProgressBar current={player.sanity} max={player.maxSanity} color="bg-blue-600" icon={<Activity size={14} className="text-blue-500"/>} />
                                     <div className="flex justify-between text-xs text-slate-500 mt-0.5">
                                        <span>ç†æ™º</span><span>{player.sanity}/{player.maxSanity}</span>
                                     </div>
                                </div>
                                <div className="col-span-2">
                                     <ProgressBar current={player.mood} max={player.maxMood} color="bg-purple-500" icon={<Smile size={14} className="text-purple-400"/>} />
                                     <div className="flex justify-between text-xs text-slate-500 mt-0.5">
                                        <span>å¿ƒæƒ…</span><span>{player.mood}/{player.maxMood}</span>
                                     </div>
                                </div>
                            </div>
                        )}

                        {/* --- SCENES --- */}

                        {scene === 'home' && (
                          <div className="flex-1 flex flex-col items-center justify-center gap-4 text-center fade-in overflow-y-auto">
                            <div className="grid grid-cols-2 gap-4 w-full">
                                <PixelCard onClick={() => { setScene('shop'); setShopTab('buy'); }}>
                                    <div className="flex flex-col items-center py-2">
                                        <ShoppingBag className="mb-2 text-yellow-500" size={32} />
                                        <span className="text-2xl">é»‘å¸‚äº¤æ˜“</span>
                                    </div>
                                </PixelCard>
                                <PixelCard onClick={() => setScene('hideout')}>
                                    <div className="flex flex-col items-center py-2">
                                        <Hammer className="mb-2 text-orange-500" size={32} />
                                        <span className="text-2xl">è—èº«å¤„</span>
                                    </div>
                                </PixelCard>
                                <PixelCard onClick={startRaid}>
                                    <div className="flex flex-col items-center py-2">
                                        <LogOut className="mb-2 text-red-500" size={32} />
                                        <span className="text-2xl">å¼€å§‹æ¢ç´¢</span>
                                    </div>
                                </PixelCard>
                                <PixelCard onClick={() => setScene('storage')}>
                                   <div className="flex flex-col items-center py-2">
                                        <Briefcase className="mb-2 text-blue-500" size={32} />
                                        <span className="text-2xl">ç‰©èµ„ä»“åº“</span>
                                    </div>
                                </PixelCard>
                            </div>
                          </div>
                        )}

                        {/* å•†åº—åœºæ™¯ - å½»åº•ä¿®å¤å¸ƒå±€ï¼Œæ ‡é¢˜æ å›ºå®š */}
                        {scene === 'shop' && (
                            <div className="flex-1 flex flex-col h-full overflow-hidden fade-in min-h-0">
                                {/* å›ºå®šå¤´éƒ¨ */}
                                <div className="flex-none bg-[#1a1c21] z-10 border-b border-slate-700 pb-2 mb-2">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-2xl text-yellow-500 tracking-widest">=== é»‘å¸‚ ===</span>
                                        <span className="text-green-400 text-xl flex items-center gap-1"><Coins size={20}/> ${player.money}</span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => setShopTab('buy')} className={`py-1 text-lg rounded ${shopTab === 'buy' ? 'bg-yellow-700 text-white' : 'bg-slate-800 text-slate-400'}`}>è¡¥ç»™</button>
                                        <button onClick={() => setShopTab('gamble')} className={`py-1 text-lg rounded ${shopTab === 'gamble' ? 'bg-purple-700 text-white' : 'bg-slate-800 text-slate-400'}`}>èµŒåœº</button>
                                    </div>
                                </div>

                                {/* æ»šåŠ¨å†…å®¹åŒºåŸŸ */}
                                <div className="flex-1 overflow-y-auto no-scrollbar space-y-3 pb-2">
                                    {shopTab === 'buy' ? (
                                        <>
                                            <h3 className="text-base text-slate-500 uppercase tracking-widest border-b border-slate-700/50 mt-2">ç”Ÿå­˜è¡¥ç»™</h3>
                                            {Object.values(ITEMS).filter(i => i.cost > 0).map(item => (
                                                <div key={item.id} onClick={() => handleShopClick(item, 'item')} 
                                                     className={`group p-3 border cursor-pointer flex justify-between items-center rounded transition-all duration-200 ${
                                                         confirmId === item.id 
                                                         ? 'bg-yellow-900/30 border-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.3)]' 
                                                         : 'bg-slate-800/50 border-slate-600 hover:bg-slate-700 hover:border-blue-600/50'
                                                     }`}>
                                                    <div>
                                                        <div className={`text-2xl ${confirmId === item.id ? 'text-yellow-400 font-bold' : 'text-blue-400 group-hover:text-blue-300'}`}>
                                                            {confirmId === item.id ? `ç¡®è®¤è´­ä¹°?` : item.name}
                                                        </div>
                                                        <div className="text-lg text-slate-500">{confirmId === item.id ? 'å†æ¬¡ç‚¹å‡»ç¡®è®¤' : item.desc}</div>
                                                    </div>
                                                    <div className="text-2xl font-bold text-yellow-500">${item.cost}</div>
                                                </div>
                                            ))}
                                            
                                            <h3 className="text-base text-slate-500 uppercase tracking-widest border-b border-slate-700/50 mt-4">æ­¦å™¨ & æŠ¤ç”²</h3>
                                            {Object.values(GEAR).filter(g => g.cost > 0).map(item => (
                                                <div key={item.id} onClick={() => handleShopClick(item, 'gear')} 
                                                     className={`group p-3 border cursor-pointer flex justify-between items-center rounded transition-all duration-200 ${
                                                         confirmId === item.id 
                                                         ? 'bg-yellow-900/30 border-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.3)]' 
                                                         : 'bg-slate-800/50 border-slate-600 hover:bg-slate-700 hover:border-yellow-600/50'
                                                     }`}>
                                                    <div>
                                                        <div className={`text-2xl ${confirmId === item.id ? 'text-yellow-400 font-bold' : 'text-green-400 group-hover:text-green-300'}`}>
                                                            {confirmId === item.id ? `ç¡®è®¤è´­ä¹°?` : item.name}
                                                        </div>
                                                        <div className="text-lg text-slate-500">{confirmId === item.id ? 'å†æ¬¡ç‚¹å‡»ç¡®è®¤' : item.desc}</div>
                                                    </div>
                                                    <div className="text-2xl font-bold text-yellow-500">${item.cost}</div>
                                                </div>
                                            ))}
                                        </>
                                    ) : (
                                        <div className="flex flex-col items-center pt-4">
                                            <h3 className="text-xl text-purple-400 mb-4 flex items-center gap-2"><Dices /> åºŸåœŸè€è™æœº</h3>
                                            
                                            <SlotMachine bet={betAmount} onSpin={handleSpin} result={slotResult} isSpinning={isSpinning} />
                                            
                                            <div className="flex gap-4 mt-4 w-full justify-center">
                                                <button onClick={() => setBetAmount(Math.max(10, betAmount - 10))} className="bg-slate-700 px-4 py-2 rounded border border-slate-500">-</button>
                                                <div className="bg-black/50 px-6 py-2 rounded text-xl border border-slate-600 w-32 text-center text-yellow-500">${betAmount}</div>
                                                <button onClick={() => setBetAmount(Math.min(player.money, betAmount + 10))} className="bg-slate-700 px-4 py-2 rounded border border-slate-500">+</button>
                                            </div>
                                            <button onClick={() => setBetAmount(Math.min(player.money, 500))} className="text-xs text-slate-500 mt-2 underline">MAX BET ($500)</button>
                                        </div>
                                    )}
                                </div>

                                {/* å›ºå®šåº•éƒ¨æŒ‰é’® */}
                                <div className="flex-none pt-3 border-t border-slate-700 mt-2">
                                    <button onClick={() => setScene('home')} className="w-full bg-slate-700 p-3 text-xl hover:bg-slate-600 border border-slate-500 text-slate-300 rounded">è¿”å›å®‰å…¨å±‹</button>
                                </div>
                            </div>
                        )}

                        {/* è—èº«å¤„ - åŒæ ·ä¿®å¤å›ºå®šå¤´éƒ¨ */}
                        {scene === 'hideout' && (
                          <div className="flex-1 flex flex-col h-full overflow-hidden fade-in min-h-0">
                            <h2 className="flex-none bg-[#1a1c21] z-10 text-center text-2xl text-orange-400 mb-4 border-b border-slate-700 py-2">=== è®¾æ–½å‡çº§ ===</h2>
                            
                            <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-2">
                                {player.facilities.workbench && (
                                    <div className="bg-slate-800 p-3 mb-4 rounded border border-blue-500/50">
                                        <h3 className="text-lg text-blue-400 mb-2">ç²¾å¯†å·¥ä½œå°</h3>
                                        <button onClick={craftAmmo} className="w-full bg-slate-700 hover:bg-slate-600 text-lg py-2 rounded border border-slate-600">
                                            åˆ¶é€ å¼¹è¯ç®± ($50 + 1åºŸé’¢)
                                        </button>
                                    </div>
                                )}

                                {Object.entries(FACILITIES).map(([key, fac]) => {
                                    const isBuilt = player.facilities[key];
                                    return (
                                        <div key={key} className={`p-3 border rounded ${isBuilt ? 'border-green-500/50 bg-green-900/10' : 'border-slate-600 bg-slate-800'}`}>
                                            <div className="flex justify-between items-center mb-1">
                                                <span className={`text-xl ${isBuilt ? 'text-green-400' : 'text-slate-200'}`}>{fac.name}</span>
                                                {isBuilt && <span className="text-sm bg-green-900 text-green-300 px-2 rounded">å·²å»ºé€ </span>}
                                            </div>
                                            <p className="text-sm text-slate-400 mb-2">{fac.desc}</p>
                                            
                                            {!isBuilt && (
                                                <div className="mt-2">
                                                    <div className="text-sm text-slate-500 mb-1">æ‰€éœ€ææ–™:</div>
                                                    <div className="grid grid-cols-2 gap-1 mb-2">
                                                        {Object.entries(fac.cost).map(([mat, count]) => {
                                                            const has = countItemInStorage(mat);
                                                            return (
                                                                <span key={mat} className={`text-sm ${has >= count ? 'text-green-500' : 'text-red-500'}`}>
                                                                    {mat}: {has}/{count}
                                                                </span>
                                                            )
                                                        })}
                                                    </div>
                                                    <button onClick={() => upgradeFacility(key)} className="w-full bg-orange-700 hover:bg-orange-600 text-white text-lg py-2 rounded">
                                                        å»ºé€ è®¾æ–½
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                            <div className="flex-none pt-3 border-t border-slate-700 mt-2">
                                <button onClick={() => setScene('home')} className="w-full bg-slate-700 p-3 text-xl hover:bg-slate-600 border border-slate-500 text-slate-300 rounded">è¿”å›</button>
                            </div>
                          </div>
                        )}

                        {/* ... (å…¶ä»–åœºæ™¯ä»£ç ç»“æ„ä¿æŒä¸å˜ï¼Œä»…äº«å—å…¨å±€å­—ä½“æ”¾å¤§æ•ˆæœ) ... */}
                        
                        {scene === 'interactive_event' && raidState.currentInteractiveEvent && (
                            <div className="flex-1 flex flex-col justify-center text-center fade-in overflow-y-auto min-h-0">
                                <div className="mb-6">
                                    <HelpCircle size={80} className="mx-auto text-blue-400 mb-4 animate-bounce" />
                                    <p className="text-2xl text-slate-200 leading-snug">{raidState.currentInteractiveEvent.text}</p>
                                </div>
                                <div className="space-y-3">
                                    {raidState.currentInteractiveEvent.choices.map(choice => (
                                        <button key={choice.id} onClick={() => handleEventChoice(choice)} className="w-full bg-slate-800 hover:bg-slate-700 border border-slate-600 p-4 rounded text-left group">
                                            <span className="block text-blue-300 text-xl group-hover:text-blue-200">{choice.text}</span>
                                            {choice.req && <span className="block text-sm text-red-400 mt-1">éœ€è¦: {choice.req.item ? ITEMS[choice.req.item]?.name || choice.req.item : `${choice.req.stat} ${choice.req.val}`}</span>}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {scene === 'storage' && (
                            <div className="flex-1 flex flex-col h-full overflow-hidden fade-in min-h-0">
                                <div className="flex-none flex justify-between items-center border-b border-slate-700 pb-2 mb-2 pt-2 bg-[#1a1c21]">
                                    <h2 className="text-2xl text-blue-400 tracking-widest">=== ä»“åº“ç®¡ç† ===</h2>
                                    <button onClick={sellAllLoot} className="text-base bg-red-900/50 text-red-300 px-3 py-1 rounded hover:bg-red-800 border border-red-700 flex items-center gap-1">
                                        <Trash2 size={16} /> ä¸€é”®å–æ‚ç‰©
                                    </button>
                                </div>
                                <div className="flex-1 overflow-y-auto no-scrollbar space-y-2 pr-1 pb-2">
                                    {player.storage.length === 0 ? <div className="text-center text-slate-600 mt-10 text-xl">ä»“åº“ç©ºç©ºå¦‚ä¹Ÿ...</div> : 
                                        player.storage.map((item, idx) => (
                                            <div key={idx} className={`p-3 border rounded flex justify-between items-center ${RARITY_CONFIG[item.rarity || 'white'].border} ${RARITY_CONFIG[item.rarity || 'white'].bg}`}>
                                                <div>
                                                    <div className={`${RARITY_CONFIG[item.rarity || 'white'].color} text-xl`}>{item.name}</div>
                                                    <div className="text-base text-slate-400 flex gap-2">
                                                        <span>{item.type === 'consumable' ? 'æ¶ˆè€—å“' : item.type === 'relic' ? 'é—ç‰©' : 'ç‰©èµ„'}</span>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    {item.type === 'consumable' || item.type === 'relic' ? (
                                                        <button onClick={() => useItem(idx)} className="bg-green-700 hover:bg-green-600 text-white px-3 py-1 text-lg rounded">{item.type === 'relic' ? 'è£…å¤‡' : 'ä½¿ç”¨'}</button>
                                                    ) : (
                                                        <button onClick={() => sellItem(idx)} className="bg-slate-700 hover:bg-slate-600 text-yellow-400 px-3 py-1 text-lg rounded border border-slate-600 flex items-center gap-1"><Coins size={16}/> ${item.val}</button>
                                                    )}
                                                </div>
                                            </div>
                                        ))
                                    }
                                </div>
                                <div className="flex-none pt-3 border-t border-slate-700 mt-2">
                                    <button onClick={() => setScene('home')} className="w-full bg-slate-700 p-3 text-xl hover:bg-slate-600 border border-slate-500 text-slate-300 rounded">è¿”å›</button>
                                </div>
                            </div>
                        )}

                        {scene === 'raid' && (
                            <div className="flex-1 flex flex-col justify-between fade-in h-full">
                                <div className="text-center space-y-6 mt-8">
                                    <div className="relative inline-block"><Footprints className="mx-auto text-slate-600" size={64} /><div className="absolute top-0 right-0 animate-ping h-3 w-3 rounded-full bg-red-500 opacity-75"></div></div>
                                    <div className="space-y-2"><div className="text-xl text-slate-500">æ­£åœ¨æœç´¢åŒºåŸŸ...</div><div className="text-5xl font-bold text-slate-200 tracking-widest">{raidState.distance}m</div></div>
                                    <div className="flex justify-center gap-2 mt-2 bg-black/20 py-2"><span className="text-xl text-slate-500 mr-2">å¨èƒç­‰çº§:</span>{[...Array(raidState.dangerLevel)].map((_, i) => (<AlertTriangle key={i} size={24} className="text-red-500" />))}</div>
                                </div>
                                <div className="grid grid-cols-2 gap-4 mt-auto mb-2">
                                     <PixelCard onClick={explore} className="bg-slate-800 hover:bg-green-900/20 border-green-800/50"><div className="text-center py-2"><span className="text-2xl font-bold text-green-500 block mb-1">&gt; ç»§ç»­æœå¯»</span><span className="text-lg text-slate-500">æ¶ˆè€—5é¥±é£Ÿ/2San</span></div></PixelCard>
                                     <PixelCard onClick={evac} className="bg-slate-800 hover:bg-blue-900/20 border-blue-800/50"><div className="text-center py-2"><span className="text-2xl font-bold text-blue-500 block mb-1">&lt; å‘¼å«æ’¤ç¦»</span><span className="text-lg text-slate-500">å¸¦å›æˆ˜åˆ©å“</span></div></PixelCard>
                                </div>
                            </div>
                        )}

                        {scene === 'event' && raidState.currentLootItem && (
                             <div className="flex-1 flex flex-col items-center justify-center text-center fade-in">
                                <div className={`p-6 bg-slate-900 rounded-full mb-6 border-4 ${RARITY_CONFIG[raidState.currentLootItem.rarity].border} shadow-[0_0_20px_rgba(0,0,0,0.5)]`}>
                                    {raidState.currentLootItem.rarity === 'special' ? <Radio size={64} className={`${RARITY_CONFIG[raidState.currentLootItem.rarity].color}`} /> : <Briefcase size={64} className={`${RARITY_CONFIG[raidState.currentLootItem.rarity].color}`} />}
                                </div>
                                <div className="mb-2 text-lg uppercase tracking-widest text-slate-500">{RARITY_CONFIG[raidState.currentLootItem.rarity].label} ç‰©èµ„</div>
                                <h2 className={`text-4xl mb-4 tracking-wide ${RARITY_CONFIG[raidState.currentLootItem.rarity].color}`}>{raidState.currentLootItem.name}</h2>
                                <div className="text-2xl text-slate-300 mb-8 space-y-2"><p className="bg-slate-800 p-3 rounded border border-slate-600 inline-block px-6">ä¼°å€¼: <span className="text-yellow-400 font-bold">${raidState.currentLootItem.val}</span></p></div>
                                <button onClick={() => setScene('raid')} className="w-full max-w-[240px] py-4 bg-slate-700 hover:bg-slate-600 text-2xl rounded border-b-4 border-slate-900 active:border-b-0 active:translate-y-1 transition-all">æ”¶å…¥èƒŒåŒ…</button>
                             </div>
                        )}

                        {scene === 'combat' && raidState.currentEnemy && (
                            <div className="flex-1 flex flex-col fade-in h-full">
                                 <div className="flex-1 flex flex-col items-center justify-center border-b-2 border-slate-700/50 border-dashed pb-6">
                                    {raidState.isGlitchEnemy ? <div className="text-8xl mb-6 animate-pulse text-red-500 scale-110">?&%#</div> : <div className="text-8xl mb-6 grayscale hover:grayscale-0 transition-all duration-500 cursor-crosshair">ğŸ‘¾</div>}
                                    <div className="text-3xl text-red-500 font-bold mb-4 tracking-wide">{raidState.currentEnemy.name}</div>
                                    <div className="w-full px-8 mb-2">{raidState.isGlitchEnemy ? <div className="text-center text-red-600 font-bold text-2xl animate-pulse">??? / ???</div> : <ProgressBar current={raidState.currentEnemy.hp} max={raidState.currentEnemy.maxHp} color="bg-purple-600" label="ENEMY" />}</div>
                                    {!raidState.isGlitchEnemy && <div className="text-xl text-slate-500 mt-2 bg-black/30 px-4 py-1 rounded">ATK: <span className="text-red-400">{raidState.currentEnemy.atk}</span></div>}
                                 </div>
                                 <div className="mt-6 grid grid-cols-2 gap-4 flex-none mb-2">
                                    <PixelCard onClick={() => handleCombat('attack')} className="border-red-900/50 hover:bg-red-900/20 group"><div className="flex items-center justify-center gap-3 py-2"><Sword size={24} className="text-red-500 group-hover:rotate-45 transition-transform" /><div className="flex flex-col items-start"><span className="text-2xl">æ”»å‡»</span>{raidState.isGlitchEnemy && <span className="text-sm text-red-400">(æ¶ˆè€—é¥±é£Ÿ)</span>}</div></div></PixelCard>
                                    <PixelCard onClick={() => handleCombat('flee')} className="group"><div className="flex items-center justify-center gap-3 py-2"><Zap size={24} className="text-yellow-500 group-hover:-translate-x-1 transition-transform" /><span className="text-2xl">é€ƒè·‘</span></div></PixelCard>
                                 </div>
                            </div>
                        )}

                         {scene === 'result' && (
                             <div className="flex-1 flex flex-col items-center justify-center text-center fade-in">
                                <Briefcase size={96} className="text-green-600 mb-6" />
                                <h2 className="text-4xl text-green-500 mb-4 tracking-widest">æ’¤ç¦»æˆåŠŸ</h2>
                                <p className="text-xl text-slate-400 mb-4">ä½ å¸¦ç€æˆ˜åˆ©å“å›åˆ°äº†å®‰å…¨å±‹ã€‚</p>
                                <div className="bg-black/20 p-4 rounded border border-slate-700 mb-8 max-h-48 overflow-y-auto w-full">
                                    <div className="text-base text-slate-500 mb-2 uppercase border-b border-slate-600">è·å¾—ç‰©å“</div>
                                    {raidState.tempLoot.map((item, i) => (<div key={i} className={`flex justify-between text-lg ${RARITY_CONFIG[item.rarity].color}`}><span>{item.name}</span><span>${item.val}</span></div>))}
                                    <div className="mt-2 pt-2 border-t border-slate-600 flex justify-between font-bold text-yellow-500 text-xl"><span>æ€»ä¼°å€¼</span><span>${raidState.tempLoot.reduce((a,b)=>a+b.val, 0)}</span></div>
                                </div>
                                <button onClick={() => setScene('storage')} className="px-8 py-4 bg-blue-900/30 border-2 border-blue-800 text-blue-400 text-2xl rounded hover:bg-blue-900/50 hover:text-blue-200 transition-colors">å‰å¾€ä»“åº“æ•´ç†</button>
                             </div>
                         )}

                         {scene === 'gameover' && (
                             <div className="flex-1 flex flex-col items-center justify-center text-center fade-in">
                                <Skull size={96} className="text-slate-700 mb-6" />
                                <h2 className="text-4xl text-red-600 mb-4 tracking-widest">è¡ŒåŠ¨å¤±è´¥</h2>
                                <p className="text-xl text-slate-400 mb-8">ä½ åœ¨åºŸåœŸä¸­å€’ä¸‹äº†ã€‚<br/>æ‰€æœ‰æºå¸¦çš„ç‰©èµ„éƒ½ä¸¢å¤±äº†ã€‚</p>
                                <button onClick={resetGame} className="px-8 py-4 bg-red-900/30 border-2 border-red-800 text-red-400 text-2xl rounded hover:bg-red-900/50 hover:text-red-200 transition-colors">é‡æ–°å¼€å§‹</button>
                             </div>
                         )}

                    </div>

                    <div className="h-36 bg-black p-3 overflow-y-auto font-mono text-base md:text-lg border-t-4 border-slate-700 z-10 no-scrollbar flex flex-col-reverse tracking-wide leading-snug flex-none">
                        {logs.map((log, i) => (
                            <div key={i} className={`mb-1 border-l-2 pl-2 ${
                                log.includes('danger') || log.includes('å—åˆ°') || log.includes('å¤±è´¥') || log.includes('ç¼ºå°‘') ? 'text-red-500 border-red-900' : 
                                log.includes('success') || log.includes('è·å¾—') || log.includes('å‡ºå”®') || log.includes('å»ºé€ ') ? 'text-green-500 border-green-900' : 
                                log.includes('blue') ? 'text-blue-400 border-blue-900' :
                                'text-slate-500 border-slate-800'
                            }`}>
                                <span className="opacity-50 mr-2">{log.match(/\[(.*?)\]/)?.[0] || '>'}</span>
                                {log.replace(/\[.*?\] /, '').replace('danger', '').replace('success', '').replace('error', '').replace('blue', '')}
                            </div>
                        ))}
                    </div>
                </div>

                <div className="mt-6 flex justify-between items-center px-6 opacity-80">
                     <div className="grid grid-cols-3 gap-1 w-24 h-24">
                        <div className="bg-slate-700 rounded col-start-2 shadow-lg"></div>
                        <div className="bg-slate-700 rounded col-start-1 row-start-2 shadow-lg"></div>
                        <div className="bg-slate-800 rounded col-start-2 row-start-2 flex items-center justify-center"><div className="w-3 h-3 rounded-full bg-black/30"></div></div>
                        <div className="bg-slate-700 rounded col-start-3 row-start-2 shadow-lg"></div>
                        <div className="bg-slate-700 rounded col-start-2 row-start-3 shadow-lg"></div>
                     </div>
                     <div className="flex gap-6 transform rotate-12">
                         <div className="w-12 h-12 rounded-full bg-red-800 shadow-[0_4px_0_rgb(80,0,0)] border-t border-red-600"></div>
                         <div className="w-12 h-12 rounded-full bg-red-800 shadow-[0_4px_0_rgb(80,0,0)] border-t border-red-600"></div>
                     </div>
                </div>

              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ExtractionGame />);
    </script>
</body>
</html>
